template:
  - binary_sensor:
      - name: "HC Z1 – First Floor Bedroom & Bath – Call For Heat"
        unique_id: hc_z1_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.z1_first_floor_bedroom_and_bath','hvac_action') %}
          {% set mode = states('climate.z1_first_floor_bedroom_and_bath') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z1_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z2 – Office & Upper Guest – Call For Heat"
        unique_id: hc_z2_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_2_second_floor_office_and_upper_guest','hvac_action') %}
          {% set mode = states('climate.zone_2_second_floor_office_and_upper_guest') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z2_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z3 – Basement Bath & Common – Call For Heat"
        unique_id: hc_z3_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_3_basement_bath_and_common','hvac_action') %}
          {% set mode = states('climate.zone_3_basement_bath_and_common') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z3_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z4 – Garage – Call For Heat"
        unique_id: hc_z4_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_4_garage','hvac_action') %}
          {% set mode = states('climate.zone_4_garage') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z4_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z5 – First Floor Living – Call For Heat"
        unique_id: hc_z5_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_5_virtual_thermostat_first_floor_living','hvac_action') %}
          {% set mode = states('climate.zone_5_virtual_thermostat_first_floor_living') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z5_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z6 – Master – Call For Heat"
        unique_id: hc_z6_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_6_master_thermostat','hvac_action') %}
          {% set mode = states('climate.zone_6_master_thermostat') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z6_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z7 – Basement Bar & TV South – Call For Heat"
        unique_id: hc_z7_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_7_basement_bar_and_tv_room_south_side','hvac_action') %}
          {% set mode = states('climate.zone_7_basement_bar_and_tv_room_south_side') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z7_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z8 – Dining Room – Call For Heat"
        unique_id: hc_z8_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_8_dining_room','hvac_action') %}
          {% set mode = states('climate.zone_8_dining_room') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z8_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}

      - name: "HC Z9 – Basement Bedroom – Call For Heat"
        unique_id: hc_z9_call_for_heat
        device_class: heat
        state: >
          {% set action = state_attr('climate.zone_9_basement_bedroom','hvac_action') %}
          {% set mode = states('climate.zone_9_basement_bedroom') %}
          {% if mode != 'heat' %}
            false
          {% elif action == 'heating' %}
            true
          {% else %}
            {% set d = states('sensor.hc_z9_delta') %}
            {{ d not in ['unknown','unavailable','none'] and d|float(0) >= states('input_number.hc_cold_tolerance')|float(0) }}
          {% endif %}
      - name: "HC Basement Call For Heat"
        unique_id: hc_basement_call_for_heat
        device_class: heat
        state: >
          {{ is_state('binary_sensor.hc_z3_call_for_heat','on')
             or is_state('binary_sensor.hc_z7_call_for_heat','on')
             or is_state('binary_sensor.hc_z9_call_for_heat','on') }}
             
      - name: "HC Garage Call For Heat"
        unique_id: hc_garage_call_for_heat
        device_class: heat
        state: "{{ is_state('binary_sensor.hc_z4_call_for_heat','on') }}"

      - name: "HC First Floor Call For Heat"
        unique_id: hc_first_floor_call_for_heat
        device_class: heat
        state: >
          {{ is_state('binary_sensor.hc_z1_call_for_heat','on')
             or is_state('binary_sensor.hc_z5_call_for_heat','on')
             or is_state('binary_sensor.hc_z8_call_for_heat','on') }}

      - name: "HC Upper Floor Call For Heat"
        unique_id: hc_upper_floor_call_for_heat
        device_class: heat
        state: >
          {{ is_state('binary_sensor.hc_z2_call_for_heat','on')
             or is_state('binary_sensor.hc_z6_call_for_heat','on') }}

      - name: "HC Whole House Call For Heat"
        unique_id: hc_whole_house_call_for_heat
        device_class: heat
        state: >
          {{ is_state('binary_sensor.hc_basement_call_for_heat','on')
             or is_state('binary_sensor.hc_first_floor_call_for_heat','on')
             or is_state('binary_sensor.hc_upper_floor_call_for_heat','on')
             or is_state('binary_sensor.hc_garage_call_for_heat','on') }}

sensor:
  - platform: history_stats
    name: "HC Z1 – First Floor Bedroom & Bath – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z1_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
    
  - platform: history_stats
    name: "HC Garage Call For Heat - Hours Today"
    entity_id: binary_sensor.hc_garage_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z2 – Office & Upper Guest – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z2_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z3 – Basement Bath & Common – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z3_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z4 – Garage – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z4_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z5 – First Floor Living – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z5_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z6 – Master – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z6_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z7 – Basement Bar & TV South – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z7_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z8 – Dining Room – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z8_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Z9 – Basement Bedroom – Call For Heat – Hours Today"
    entity_id: binary_sensor.hc_z9_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Basement Call For Heat - Hours Today"
    entity_id: binary_sensor.hc_basement_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC First Floor Call For Heat - Hours Today"
    entity_id: binary_sensor.hc_first_floor_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Upper Floor Call For Heat - Hours Today"
    entity_id: binary_sensor.hc_upper_floor_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"

  - platform: history_stats
    name: "HC Whole House Call For Heat - Hours Today"
    entity_id: binary_sensor.hc_whole_house_call_for_heat
    state: "on"
    type: time
    start: "{{ now().replace(hour=0, minute=0, second=0) }}"
    end: "{{ now() }}"
